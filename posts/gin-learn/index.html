<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Gin Learn - ThinkDiffW</title><meta name=viewport content="width=device-width,initial-scale=1"><meta itemprop=name content="Gin Learn"><meta itemprop=description content="概览 与Spring MVC对比 @Controller RouterGroup.Group() ，路由分组
@RequestMapping RouterGroup.GET(), RouterGroup.POST()…
@RequestParam Spring MVC中@RequestParma适用于query, form data , multipart，gin会细分
Context.Query(), Context.DefaultQuery()
Context.PostForm(), Context.DefaultPostForm()
@RequestParam MultiPartFile ↔ Context.FormFile()
@PathVariable “/url/:param/*action”, Context.Param()
@RequestBody Bind() 利用content-type和struct tag解析支持url path、header、query、form-data、json、xml等，ShouldBindQuery，ShouldBindJSON
MustBindWith() 异常情况下中断请求并返回400
由于Request.Body只能读取一次，使用ShouldBindBodyWith() 可以缓存Body，对性能有轻微的影响
@Valid JSR303 OR @Validated @Validated相比较JSR303@Valid 增加了分组校验
type Login struct { User string `json:&#34;user&#34; binding:&#34;required&#34;` Password string `json:&#34;password&#34; binding:&#34;required&#34;` } @ResponseBody Context.JSON(), Context.String(), Context.XML(), Context.File()
静态资源
RouterGroup.StaticFile() 返回单个文件
RouterGroup.Static(&#34;/static&#34;, &#34;/var/www&#34;) 返回指定目录下文件
Context.HTML() HTML模版渲染
自定义渲染 Contenxt.DataFromReader() 或者 Contenxt."><meta itemprop=datePublished content="2022-12-14T15:48:40+08:00"><meta itemprop=dateModified content="2022-12-14T15:48:40+08:00"><meta itemprop=wordCount content="184"><meta itemprop=keywords content><meta property="og:title" content="Gin Learn"><meta property="og:description" content="概览 与Spring MVC对比 @Controller RouterGroup.Group() ，路由分组
@RequestMapping RouterGroup.GET(), RouterGroup.POST()…
@RequestParam Spring MVC中@RequestParma适用于query, form data , multipart，gin会细分
Context.Query(), Context.DefaultQuery()
Context.PostForm(), Context.DefaultPostForm()
@RequestParam MultiPartFile ↔ Context.FormFile()
@PathVariable “/url/:param/*action”, Context.Param()
@RequestBody Bind() 利用content-type和struct tag解析支持url path、header、query、form-data、json、xml等，ShouldBindQuery，ShouldBindJSON
MustBindWith() 异常情况下中断请求并返回400
由于Request.Body只能读取一次，使用ShouldBindBodyWith() 可以缓存Body，对性能有轻微的影响
@Valid JSR303 OR @Validated @Validated相比较JSR303@Valid 增加了分组校验
type Login struct { User string `json:&#34;user&#34; binding:&#34;required&#34;` Password string `json:&#34;password&#34; binding:&#34;required&#34;` } @ResponseBody Context.JSON(), Context.String(), Context.XML(), Context.File()
静态资源
RouterGroup.StaticFile() 返回单个文件
RouterGroup.Static(&#34;/static&#34;, &#34;/var/www&#34;) 返回指定目录下文件
Context.HTML() HTML模版渲染
自定义渲染 Contenxt.DataFromReader() 或者 Contenxt."><meta property="og:type" content="article"><meta property="og:url" content="https://thinkdiffw.github.io/posts/gin-learn/"><meta property="article:published_time" content="2022-12-14T15:48:40+08:00"><meta property="article:modified_time" content="2022-12-14T15:48:40+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gin Learn"><meta name=twitter:description content="概览 与Spring MVC对比 @Controller RouterGroup.Group() ，路由分组
@RequestMapping RouterGroup.GET(), RouterGroup.POST()…
@RequestParam Spring MVC中@RequestParma适用于query, form data , multipart，gin会细分
Context.Query(), Context.DefaultQuery()
Context.PostForm(), Context.DefaultPostForm()
@RequestParam MultiPartFile ↔ Context.FormFile()
@PathVariable “/url/:param/*action”, Context.Param()
@RequestBody Bind() 利用content-type和struct tag解析支持url path、header、query、form-data、json、xml等，ShouldBindQuery，ShouldBindJSON
MustBindWith() 异常情况下中断请求并返回400
由于Request.Body只能读取一次，使用ShouldBindBodyWith() 可以缓存Body，对性能有轻微的影响
@Valid JSR303 OR @Validated @Validated相比较JSR303@Valid 增加了分组校验
type Login struct { User string `json:&#34;user&#34; binding:&#34;required&#34;` Password string `json:&#34;password&#34; binding:&#34;required&#34;` } @ResponseBody Context.JSON(), Context.String(), Context.XML(), Context.File()
静态资源
RouterGroup.StaticFile() 返回单个文件
RouterGroup.Static(&#34;/static&#34;, &#34;/var/www&#34;) 返回指定目录下文件
Context.HTML() HTML模版渲染
自定义渲染 Contenxt.DataFromReader() 或者 Contenxt."><link href="https://fonts.googleapis.com/css?family=Playfair+Display:700" rel=stylesheet type=text/css><link rel=stylesheet type=text/css media=screen href=https://thinkdiffw.github.io/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://thinkdiffw.github.io/css/main.css><link id=dark-scheme rel=stylesheet type=text/css href=https://thinkdiffw.github.io/css/dark.css><script src=https://thinkdiffw.github.io/js/main.js></script></head><body><div class="container wrapper"><div class=header><h1 class=site-title><a href=https://thinkdiffw.github.io/>ThinkDiffW</a></h1><div class=site-description><nav class="nav social"><ul class=flat></ul></nav></div><nav class=nav><ul class=flat></ul></nav></div><div class=post><div class=post-header><div class=meta><div class=date><span class=day>14</span>
<span class=rest>Dec 2022</span></div></div><div class=matter><h1 class=title>Gin Learn</h1></div></div><div class=markdown><h1 id=概览>概览</h1><h2 id=与spring-mvc对比>与Spring MVC对比</h2><h3 id=controller>@Controller</h3><p>RouterGroup.Group() ，路由分组</p><h3 id=requestmapping>@RequestMapping</h3><p>RouterGroup.GET(), RouterGroup.POST()…</p><h3 id=requestparam>@RequestParam</h3><p>Spring MVC中@RequestParma适用于query, form data , multipart，gin会细分</p><p>Context.Query(), Context.DefaultQuery()</p><p>Context.PostForm(), Context.DefaultPostForm()</p><p><code>@RequestParam MultiPartFile</code> ↔ Context.FormFile()</p><h3 id=pathvariable>@PathVariable</h3><p>“/url/:param/*action”, Context.Param()</p><h3 id=requestbody>@RequestBody</h3><p><code>Bind()</code> 利用content-type和struct tag解析支持url path、header、query、form-data、json、xml等，ShouldBindQuery，ShouldBindJSON</p><p><code>MustBindWith()</code> 异常情况下中断请求并返回400</p><p>由于Request.Body只能读取一次，使用<code>ShouldBindBodyWith()</code> 可以缓存Body，对性能有轻微的影响</p><h3 id=valid-jsr303-or-validated>@Valid JSR303 OR @Validated</h3><p>@Validated相比较JSR303@Valid 增加了分组校验</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Login</span> <span style=color:#66d9ef>struct</span> {
  <span style=color:#a6e22e>User</span>     <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;user&#34; binding:&#34;required&#34;`</span>
  <span style=color:#a6e22e>Password</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;password&#34; binding:&#34;required&#34;`</span>
}
</code></pre></div><h3 id=responsebody>@ResponseBody</h3><p>Context.JSON(), Context.String(), Context.XML(), Context.File()</p><p>静态资源</p><p><code>RouterGroup.StaticFile()</code> 返回单个文件</p><p><code>RouterGroup.Static("/static", "/var/www")</code> 返回指定目录下文件</p><p><code>Context.HTML()</code> HTML模版渲染</p><p>自定义渲染 <code>Contenxt.DataFromReader()</code> 或者 <code>Contenxt.Render()</code></p><h3 id=handlerinterceptor>HandlerInterceptor</h3><p>全局的 Engine.Use() 或者 自定义path的RouterGroup.Use()</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>adminGroup</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Group</span>(<span style=color:#e6db74>&#34;/admin&#34;</span>)
<span style=color:#a6e22e>adminGroup</span>.<span style=color:#a6e22e>Use</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>context</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Context</span>) {
    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;admin group accessed&#34;</span>)
})
</code></pre></div><h3 id=exceptionhandler>@ExceptionHandler</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Use</span>(<span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>CustomRecovery</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>interface</span>{}) {
		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#66d9ef>string</span>); <span style=color:#a6e22e>ok</span> {
			<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>, <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>H</span>{
				<span style=color:#e6db74>&#34;errCode&#34;</span>: <span style=color:#e6db74>&#34;internal-error&#34;</span>,
				<span style=color:#e6db74>&#34;errMsg&#34;</span>:  <span style=color:#a6e22e>err</span>,
			})
		}
		<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>AbortWithStatus</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
	}))
</code></pre></div><h3 id=responsesendredirect>Response.sendRedirect()</h3><p>Context.Redirect(statusCode, location) 内部或者外部地址都支持</p><h3 id=日志>日志</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Create</span>(<span style=color:#e6db74>&#34;biz.log&#34;</span>)
<span style=color:#75715e>// 同时输出到文件和控制台
</span><span style=color:#75715e></span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>DefaultWriter</span> = <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>MultiWriter</span>(<span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>)
</code></pre></div><h3 id=特有语法>特有语法</h3><p>Context.QueryMap(),Context.PostFormMap()支持我没见过的传参数，/url?param[key1]=values1&param[key2]=value2</p><h1 id=主要结构体>主要结构体</h1><h2 id=engine>Engine</h2><p>Engine 框架实例，<code>it contains the muxer, middleware and configuration settings.</code></p><p><code>middleware</code> 可以理解为Spring MVC中的Filter，或者叫中间件, 中间处理函数</p><p>Engine 结构</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Engine</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#a6e22e>RouterGroup</span> <span style=color:#75715e>// 嵌套结构体，继承RouterGroup的方法，配置路由，包含前缀和一组处理器
</span><span style=color:#75715e></span>	<span style=color:#f92672>...</span><span style=color:#75715e>//一些其他配置
</span><span style=color:#75715e></span>}
</code></pre></div><p>通过<code>New()</code>或者<code>Default()</code>创建Engine</p><p><code>New()</code> 创建一个空白的没有任何<code>middleware</code>的实例</p><p><code>Default()</code> 创建一个带有 <code>Logger</code> 和<code>Recovery</code>的实例，<code>engine.Use(Logger(), Recovery())</code></p><p><code>Use()</code> 创建全局的<code>middleware</code></p><p><code>gin.LoggerWithFormatter()</code> 请求日志格式化</p><h2 id=context>Context</h2><p>Cookie管理 <code>c.Cookie()</code> <code>c.SetCookie()</code></p><p>获取客户端IP <code>c.ClientIP()</code></p><p>Header管理 <code>c.Header()</code> <code>c.getHeader()</code></p><p>元数据管理 <code>c.Get()</code> <code>c.Set()</code></p><p>协程中安全使用 <code>c.Copy()</code></p><h3 id=流程控制>流程控制</h3><p>c.Next() 仅在middleware中使用，PostHandle处理</p><p>c.Abort() 组织后续handler处理，不回停止当前handler，如在授权逻辑中使用</p></div><div class=tags></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='prepoet';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class="footer wrapper"><nav class=nav><div>2022 <a href=https://github.com/knadh/hugo-ink>Ink</a> theme on <a href=https://gohugo.io>Hugo</a></div></nav></div></body></html>